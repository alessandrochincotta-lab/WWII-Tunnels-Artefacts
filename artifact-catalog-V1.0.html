<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WWII Tunnels - Artifact Catalog</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: #e63946;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
        }

        h1 {
            font-size: 28px;
            color: #fff;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            margin-top: 5px;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: rgba(230, 57, 70, 0.9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(230, 57, 70, 0.3);
        }

        .btn:hover {
            background: rgba(230, 57, 70, 1);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(230, 57, 70, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: none;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-success {
            background: rgba(76, 175, 80, 0.9);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-success:hover {
            background: rgba(76, 175, 80, 1);
        }

        .search-bar {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .search-input {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #e63946;
            background: rgba(255, 255, 255, 0.15);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .filters {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: #e63946;
            border-color: #e63946;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stats-bar {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 25px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-value {
            color: #e63946;
            font-size: 24px;
            font-weight: bold;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .artifact-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .artifact-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(230, 57, 70, 0.3);
        }

        .artifact-image {
            width: 100%;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: rgba(255, 255, 255, 0.3);
            overflow: hidden;
        }

        .artifact-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .artifact-info {
            padding: 20px;
        }

        .artifact-number {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
            margin-bottom: 5px;
        }

        .artifact-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #fff;
        }

        .artifact-meta {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        .artifact-location {
            color: #e63946;
        }

        .list-view {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .list-item {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            color: #fff;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .detail-section {
            margin-bottom: 25px;
        }

        .detail-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .detail-value {
            color: #fff;
            font-size: 16px;
            line-height: 1.6;
        }

        .photo-section {
            margin-bottom: 25px;
        }

        .photo-display {
            width: 100%;
            max-height: 400px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .photo-display img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .photo-placeholder {
            color: rgba(255, 255, 255, 0.3);
            font-size: 64px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #e63946;
            background: rgba(255, 255, 255, 0.15);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .file-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: #e63946;
            background: rgba(255, 255, 255, 0.05);
        }

        .file-upload-area.active {
            border-color: #e63946;
            background: rgba(230, 57, 70, 0.1);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-excellent {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .status-good {
            background: rgba(33, 150, 243, 0.2);
            color: #2196f3;
        }

        .status-fair {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .status-poor {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.5);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .floor-plan-section {
            margin-top: 30px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .floor-plan-image {
            width: 100%;
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }

        .floor-plan-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        .import-success {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid rgba(76, 175, 80, 0.5);
            color: #4caf50;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .import-error {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid rgba(244, 67, 54, 0.5);
            color: #f44336;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }

            .controls {
                width: 100%;
            }

            .btn {
                flex: 1;
            }

            .stats-bar {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Firebase Configuration - ADD YOUR CONFIG HERE
        const firebaseConfig = {
            apiKey: "AIzaSyChvAKKfDCkljNQmTyQsrhE57pm4H751EQ",
            authDomain: "wrighttech-inventory.firebaseapp.com",
            projectId: "wrighttech-inventory",
            storageBucket: "wrighttech-inventory.firebasestorage.app",
            messagingSenderId: "891021456690",
            appId: "1:891021456690:web:e81d5b7ff36dd3f687532b"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Pre-loaded artifacts data from Excel
        const ARTIFACTS_DATA = [{"itemNumber":1,"name":"P8 water compass","location":"Spitfire Hall","description":"Original Spitfire compass","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":2,"name":"Type C Helmet","location":"Spitfire Hall","description":"Original flying helmet","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":3,"name":"Spitfire fighter fund","location":"Spitfire Hall","description":"Fundraising poster","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":4,"name":"Gibraltar spitfire replica","location":"Spitfire Hall","description":"Replica plane","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":5,"name":"4x Replica .303 SMLE","location":"Strategy Room","description":"Replica rifles","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":6,"name":"4 Rifle rack","location":"Strategy Room","description":"Original rifle rack","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":7,"name":"Thor chipping hammer drill","location":"Strategy Room ","description":"Original royal engineers drill","donor":"MoE","lastServiced":"","servicingDetails":"Change label name","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":8,"name":"6x Brodie helmet","location":"Strategy Room ","description":"Replica helmets","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":9,"name":"3x Replica WWII Phones","location":"Strategy Room ","description":"Interactive phones","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":10,"name":"1x Replica WWII Radio","location":"Strategy Room ","description":"Replica radio","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":11,"name":"5x Assorted diamond drill bits","location":"Strategy Room ","description":"Original drill bits","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":12,"name":"Miners pickaxe","location":"Strategy Room ","description":"Tunelling tool","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":13,"name":"Ottawa chamber","location":"Strategy Room ","description":"Original tunnel sign","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":14,"name":"Rock core sample","location":"Strategy Room ","description":"Limestone rock core","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":15,"name":"Lamp electric No. 1","location":"Strategy Room ","description":"Original hand torch","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":16,"name":"Respirator and Haversack","location":"Strategy Room ","description":"Original lamp","donor":"Simon Woolley","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":17,"name":"Monophone (cased)","location":"Strategy Room ","description":"Original office receiver","donor":"Carl Alecio","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":18,"name":"Tele F + breastplate speaker","location":"Strategy Room ","description":"Original field telephone + speaker","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":19,"name":"Tele L telephone","location":"Strategy Room ","description":"Original field telephone","donor":"Christian Debono","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":20,"name":"Chicago pneumatic 09","location":"Strategy Room ","description":"Original drill","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":21,"name":"Chicago pneumatic poster","location":"Strategy Room ","description":"Poster","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":22,"name":"Broomwade chipping hammer","location":"Strategy Room ","description":"Original rock drill","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":23,"name":"Carbide lamp","location":"Strategy Room ","description":"Original miners lamp","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":24,"name":"Wheathamsptead coal miners hat","location":"Strategy Room ","description":"Original helmet","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":25,"name":"Burma stores central","location":"Strategy Room ","description":"Original tunnel sign","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":26,"name":"Core samples","location":"Strategy Room ","description":"3 core samples","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":27,"name":"BSA M20 motorcycle","location":"Sapper Suite","description":"Original motorcycle (1942)","donor":"Phil Humphries","lastServiced":"November","servicingDetails":"Needs servicing every 3 months","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":28,"name":"Jerry can","location":"Sapper Suite","description":"Original jerry can","donor":"Chris Sant","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":29,"name":"Oil can","location":"Sapper Suite","description":"Original oil can","donor":"Chris Sant","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":30,"name":"Spare tank","location":"Sapper Suite","description":"Original tabk","donor":"Phil Humphries","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":31,"name":"Spare tire","location":"Sapper Suite","description":"Original tire","donor":"Phil Humphries","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":32,"name":"BSA tool wallet + BSA tools","location":"Sapper Suite","description":"Original motorcycle tools","donor":"Phil Humphries","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":33,"name":"Lamp","location":"Sapper Suite","description":"Original lamp","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":34,"name":"Toolbox + tools","location":"Sapper Suite","description":"Standard tools","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":35,"name":"39x plaques ","location":"Sapper Suite","description":"Assorted military plaques","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":36,"name":"21x plaques","location":"Sapper Suite","description":"Assorted military plaques","donor":"Convent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":37,"name":"8x Plaques","location":"Gunners Gallery","description":"Assorted military plaques","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":38,"name":"Gunners Gallery plaques","location":"Gunners Gallery","description":"Artillery plaques","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":39,"name":"Bofors anti-aircraft cartridge case ","location":"Gunners Gallery","description":"Original cartridge case + warhead","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":40,"name":"4.5 inch naval cartridge case","location":"Gunners Gallery","description":"Original cartridge case ","donor":"Leo Hayes","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":41,"name":"4.5 inch primer","location":"Gunners Gallery","description":"Original primer","donor":"Eddie Vincent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":42,"name":"9.2 inch bore brush","location":"Gunners Gallery","description":"Cleaning brush","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":43,"name":"25-pounder charge bags","location":"Gunners Gallery","description":"Drill charge bags x3","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":44,"name":"25-pounder primer","location":"Gunners Gallery","description":"Original primer","donor":"Eddie Vincent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":45,"name":"Fuze NO119-1 (25 Pdr)","location":"Gunners Gallery","description":"Drill fuse","donor":"Eddie Vincent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":46,"name":"25 Pdr maintenance schedule ","location":"Gunners Gallery","description":"Book","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":47,"name":"Range clinometer","location":"Gunners Gallery","description":"Gunners quadrant","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":48,"name":"Case carrying gunners quad - leather","location":"Gunners Gallery","description":"Carrying case","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":49,"name":"25-PDR Dial sight","location":"Gunners Gallery","description":"No9 MK1","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":50,"name":"Maintenance scheudle ","location":"Gunners Gallery","description":"Book","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":51,"name":"Bren gun","location":"Gunners Gallery","description":"Original light machine gun","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":52,"name":"x15 Bren gun shells cases","location":"Gunners Gallery","description":"Original cases","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":53,"name":"Governors comission #1","location":"Gunners Gallery","description":"Original certificate","donor":"J Alcantara","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":54,"name":"Personal documentation","location":"Gunners Gallery","description":"GDF certificate of service","donor":"","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":55,"name":"GDF sweetheart brooch","location":"Gunners Gallery","description":"Brooch ","donor":"Capt. John Alcantara","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":56,"name":"Cap badges","location":"Gunners Gallery","description":"Badges","donor":"J Francis ","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":57,"name":"Uniform accountrements","location":"Gunners Gallery","description":"Shoulder titles + other uniform items","donor":"J Francis ","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":58,"name":"Unit photograph","location":"Gunners Gallery","description":"Photo frame","donor":"Capt. John Alcantara","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":59,"name":"Training books","location":"Gunners Gallery","description":"Nmumerous books","donor":"J Francis","lastServiced":"","servicingDetails":"Missing a descrption","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":60,"name":"Gib defence force battledress","location":"Gunners Gallery","description":"Original uniform (1950)","donor":"J Francis + Sean Yeo","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":61,"name":"WWII air raid siren","location":"Gunners Gallery","description":"Hand operated crank siren","donor":"Micro business systems","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":62,"name":"Governors comission #2","location":"Gunners Gallery","description":"Original certificate","donor":"J Francis","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":63,"name":"Efficiency decoration","location":"Gunners Gallery","description":"Medal of service","donor":"J Francis","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":64,"name":"Personal issue","location":"Gunners Gallery","description":"Collection of items x3","donor":"J Francis","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":65,"name":"Commerative embroidery","location":"Gunners Gallery","description":"50th anniversary Gibraltar Regiment","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":66,"name":"Pace stick","location":"Gunners Gallery","description":"Pace stick","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":67,"name":"Bitumen tar pourer","location":"Corridor","description":"Original tar primer","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":68,"name":"Brodie helmet x1","location":"Corridor","description":"Replica helmet","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":69,"name":"Haversack respirator","location":"Corridor","description":"Replica respirator","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":70,"name":"Webbing pouches replica","location":"Corridor","description":"Replica webbing","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":71,"name":"Holman SL303 rock drill ","location":"Shop (to move to sapper suite)","description":"Original drill ","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":72,"name":"Thor drill x2 (serial: 5755 +6631)","location":"Workshop (to move to sapper suite)","description":"Original drills","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":73,"name":"Atlas copco","location":"Workshop (to move to sapper suite)","description":"Original drill ","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":74,"name":"3.7 inch VT fuse","location":"Workshop ","description":"Original fuse","donor":"Eddie Vincent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":75,"name":"Artillery shell primer (various) x3","location":"Workshop","description":"Original dummy fuse","donor":"Eddie Vincent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":76,"name":"25 Pdr charge bags x3","location":"Workshop","description":"Drill charge bags","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":77,"name":"Ammunition box H83","location":"Workshop","description":"25 pdr cartdridge box 6x6","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":78,"name":"25 Pdr cartridge case x4","location":"Workshop","description":"Original cartridge cases x5","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":79,"name":"Jackleg drills x2","location":"Workshop","description":"Original jacklegs","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":80,"name":"x1 Bren gun shell case","location":"Workshop","description":"Original cases","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":81,"name":"3x plaques","location":"Workshop","description":"Military plaques","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":82,"name":"3x plaques","location":"Workshop","description":"Military plaques","donor":"Convent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":83,"name":"Pickaxe head","location":"Workshop","description":"Original pickaxe head","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":84,"name":"Muzzle brake 25 Pdr","location":"Workshop","description":"Original muzzle brake pdr","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":85,"name":"Breech block 25 Pdr","location":"Workshop","description":"Original breech block","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":86,"name":"105mm cartridge (on stand)","location":"Workshop","description":"Original cartridge ","donor":"Eddie Vincent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":87,"name":"Benchgun detatchment 9.2 x2","location":"Workshop","description":"Original benchgun detatchment","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":88,"name":"Spares box 25 Pdr","location":"Workshop","description":"Spares box","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":89,"name":"Bren gun case carrying magazine (With magazines)","location":"Workshop","description":"Original case","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":90,"name":"Cooker portable #2 (with tools)","location":"Workshop","description":"Original cooker","donor":"Christian Debono","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":91,"name":"Ammo box (empty) 1950s","location":"Workshop","description":"Ammo box","donor":"Carl Alesio","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":92,"name":"Ammo box 1941","location":"Workshop","description":"Ammo box","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":93,"name":"Bren gun box ","location":"Workshop","description":"original","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":94,"name":"Various brass pressure gauges","location":"Workshop","description":"Pressure gauges","donor":"Christian Debono","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":95,"name":"24 pound canon ball","location":"Workshop","description":"Canon ball","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":96,"name":"24 pound bursting shell","location":"Workshop","description":"Canon ball","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":97,"name":"24 pound cannon ball","location":"Office","description":"Original canonball ","donor":"Dylan Dalli/ WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":98,"name":"Fuel sampling vessel (copper)","location":"Office","description":"Original fuel vessel","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":99,"name":"Ammeter (boxed)","location":"Office","description":"Original ammeter","donor":"Carl Alecio","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":100,"name":"Spiritlevel (wood)","location":"Office","description":"Spiritlevel","donor":"Carl Alecio","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":101,"name":"Joiners ruler (wood)","location":"Office","description":"Joiners ruler","donor":"Carl Alecio","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":102,"name":"5 key bunch","location":"Office","description":"Decorative keys","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":103,"name":"Led graffiti plaque (Sapper peate)","location":"Office","description":"Plaque","donor":"Pete Jackson","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":104,"name":"Naval plaque","location":"Office","description":"Plaque","donor":"Convent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":105,"name":"USS Winston Churchill plaque","location":"Office","description":"Plaque","donor":"Convent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":106,"name":"2-inch cartridge (brass)","location":"Office","description":"Original cartridge","donor":"Eddie Vincent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":107,"name":"Evacuees suitcase Leather (J Nunez)","location":"Office","description":"Containing: Various military photos","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":108,"name":"Wooden evacuees chest (I Azzopardi)","location":"","description":"","donor":"Lesley Whitwell","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":109,"name":"Evacuees suitcase leather  ","location":"","description":"Containing: Sunlight soap (boxed), Lever products brochure, Enamel mug + plate, silver fork + bone handled knife, civilian respirator (boxed)","donor":"WT","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":110,"name":"Military photo ","location":"Office","description":"Photo","donor":"J Alacantara","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":111,"name":"1958 pattern webbing","location":"Office","description":"Original webbing","donor":"Eddie Vincent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":112,"name":"Painting of spitfire","location":"Office","description":"Painting","donor":"P.C. Dan Roffel","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":113,"name":"Photo of spitfires","location":"Office","description":"Photo","donor":"P.C. Dan Roffel","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":114,"name":"Photo of RAF in Gibraltar","location":"Office","description":"Photo","donor":"Convent","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":115,"name":"Roadbrealer drill","location":"Office","description":"Original drill ","donor":"","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":116,"name":"4x Brodie Helmet","location":"Old store","description":"Replica helmet","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":117,"name":"2x Haversack respirator ","location":"Old store","description":"Replica respirator","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""},{"itemNumber":118,"name":"2x webbing set","location":"Old store","description":"Replica webbing","donor":"MoE","lastServiced":"","servicingDetails":"","photos":[],"condition":"Good","conditionNotes":""}];

        function App() {
            const [artifacts, setArtifacts] = useState([]);
            const [filteredArtifacts, setFilteredArtifacts] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedLocation, setSelectedLocation] = useState('All');
            const [viewMode, setViewMode] = useState('gallery');
            const [selectedArtifact, setSelectedArtifact] = useState(null);
            const [showAddModal, setShowAddModal] = useState(false);
            const [showEditModal, setShowEditModal] = useState(false);
            const [showFloorPlan, setShowFloorPlan] = useState(false);
            const [loading, setLoading] = useState(true);
            const [importStatus, setImportStatus] = useState(null);
            const [uploadingPhoto, setUploadingPhoto] = useState(false);

            // Get unique locations from artifacts
            const locations = ['All', ...new Set(artifacts.map(a => a.location).filter(Boolean))].sort();

            // Load artifacts from Firebase
            useEffect(() => {
                const unsubscribe = db.collection('museum_artifacts').onSnapshot(snapshot => {
                    const artifactsData = [];
                    snapshot.forEach(doc => {
                        artifactsData.push({ id: doc.id, ...doc.data() });
                    });
                    // Sort by item number
                    artifactsData.sort((a, b) => (a.itemNumber || 0) - (b.itemNumber || 0));
                    setArtifacts(artifactsData);
                    setFilteredArtifacts(artifactsData);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, []);

            // Filter artifacts
            useEffect(() => {
                let filtered = artifacts;

                if (selectedLocation !== 'All') {
                    filtered = filtered.filter(a => a.location === selectedLocation);
                }

                if (searchTerm) {
                    filtered = filtered.filter(a => 
                        a.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        a.location?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        a.description?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        a.donor?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        a.itemNumber?.toString().includes(searchTerm)
                    );
                }

                setFilteredArtifacts(filtered);
            }, [searchTerm, selectedLocation, artifacts]);

            // Import Excel data to Firebase
            const importExcelData = async () => {
                if (!window.confirm(`This will import ${ARTIFACTS_DATA.length} artifacts from the Excel file. Continue?`)) {
                    return;
                }

                try {
                    setLoading(true);
                    const batch = db.batch();
                    
                    ARTIFACTS_DATA.forEach(artifact => {
                        const docRef = db.collection('museum_artifacts').doc();
                        batch.set(docRef, {
                            ...artifact,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });

                    await batch.commit();
                    setImportStatus({ success: true, count: ARTIFACTS_DATA.length });
                    setTimeout(() => setImportStatus(null), 5000);
                } catch (error) {
                    console.error('Import error:', error);
                    setImportStatus({ success: false, message: error.message });
                }
            };

            // Upload photo
            const uploadPhoto = async (file, artifactId) => {
                if (!file) return null;

                try {
                    setUploadingPhoto(true);
                    const storageRef = storage.ref();
                    const photoRef = storageRef.child(`museum_artifacts/${artifactId}/${Date.now()}_${file.name}`);
                    await photoRef.put(file);
                    const url = await photoRef.getDownloadURL();
                    setUploadingPhoto(false);
                    return url;
                } catch (error) {
                    console.error('Photo upload error:', error);
                    setUploadingPhoto(false);
                    alert('Error uploading photo');
                    return null;
                }
            };

            const ArtifactCard = ({ artifact }) => (
                <div className="artifact-card" onClick={() => setSelectedArtifact(artifact)}>
                    <div className="artifact-image">
                        {artifact.photos && artifact.photos.length > 0 ? (
                            <img src={artifact.photos[0]} alt={artifact.name} />
                        ) : (
                            'üèõÔ∏è'
                        )}
                    </div>
                    <div className="artifact-info">
                        <div className="artifact-number">Item #{artifact.itemNumber}</div>
                        <div className="artifact-name">{artifact.name}</div>
                        <div className="artifact-meta">
                            <div className="artifact-location">üìç {artifact.location}</div>
                        </div>
                    </div>
                </div>
            );

            const ListView = () => (
                <div className="list-view">
                    {filteredArtifacts.map(artifact => (
                        <div key={artifact.id} className="list-item" onClick={() => setSelectedArtifact(artifact)}>
                            <div>
                                <div className="artifact-number" style={{marginBottom: '5px'}}>
                                    Item #{artifact.itemNumber}
                                </div>
                                <div className="artifact-name">{artifact.name}</div>
                                <div className="artifact-meta">
                                    <span className="artifact-location">{artifact.location}</span>
                                    {artifact.description && (
                                        <span style={{color: 'rgba(255,255,255,0.5)', marginLeft: '10px'}}>
                                            {artifact.description.substring(0, 50)}...
                                        </span>
                                    )}
                                </div>
                            </div>
                            <div>‚Üí</div>
                        </div>
                    ))}
                </div>
            );

            const DetailModal = ({ artifact, onClose }) => {
                if (!artifact) return null;

                const fileInputRef = useRef(null);
                const [imageFit, setImageFit] = useState('contain');

                const handlePhotoUpload = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    const photoUrl = await uploadPhoto(file, artifact.id);
                    if (photoUrl) {
                        const newPhotos = artifact.photos ? [...artifact.photos, photoUrl] : [photoUrl];
                        await db.collection('museum_artifacts').doc(artifact.id).update({
                            photos: newPhotos
                        });
                    }
                };

                return (
                    <div className="modal" onClick={onClose}>
                        <div className="modal-content" onClick={e => e.stopPropagation()}>
                            <div className="modal-header">
                                <h2 className="modal-title">{artifact.name}</h2>
                                <button className="close-btn" onClick={onClose}>√ó</button>
                            </div>

                            <div className="photo-section">
                                <div className="detail-label">Photo</div>
                                <div className="photo-display">
                                    {artifact.photos && artifact.photos.length > 0 ? (
                                        <img 
                                            src={artifact.photos[0]} 
                                            alt={artifact.name}
                                            style={{objectFit: imageFit}}
                                        />
                                    ) : (
                                        <div className="photo-placeholder">üì∑</div>
                                    )}
                                </div>
                                <div style={{display: 'flex', gap: '10px', marginTop: '10px'}}>
                                    <input 
                                        type="file" 
                                        ref={fileInputRef}
                                        accept="image/*"
                                        style={{display: 'none'}}
                                        onChange={handlePhotoUpload}
                                    />
                                    <button 
                                        className="btn btn-secondary" 
                                        style={{flex: 1}}
                                        onClick={() => fileInputRef.current?.click()}
                                        disabled={uploadingPhoto}
                                    >
                                        {uploadingPhoto ? 'Uploading...' : 
                                         artifact.photos?.length > 0 ? 'Replace Photo' : 'Add Photo'}
                                    </button>
                                    {artifact.photos?.length > 0 && (
                                        <button 
                                            className="btn btn-secondary"
                                            style={{flex: 1}}
                                            onClick={() => setImageFit(imageFit === 'contain' ? 'cover' : 'contain')}
                                        >
                                            {imageFit === 'contain' ? 'Fill Space' : 'Fit Whole'}
                                        </button>
                                    )}
                                </div>
                            </div>

                            <div className="detail-section">
                                <div className="detail-label">Item Number</div>
                                <div className="detail-value">#{artifact.itemNumber}</div>
                            </div>

                            <div className="detail-section">
                                <div className="detail-label">Location</div>
                                <div className="detail-value">{artifact.location}</div>
                            </div>

                            {artifact.description && (
                                <div className="detail-section">
                                    <div className="detail-label">Description</div>
                                    <div className="detail-value">{artifact.description}</div>
                                </div>
                            )}

                            {artifact.donor && (
                                <div className="detail-section">
                                    <div className="detail-label">Donor / Source</div>
                                    <div className="detail-value">{artifact.donor}</div>
                                </div>
                            )}

                            {artifact.condition && (
                                <div className="detail-section">
                                    <div className="detail-label">Condition</div>
                                    <div className="detail-value">
                                        <span className={`status-badge status-${artifact.condition.toLowerCase()}`}>
                                            {artifact.condition}
                                        </span>
                                    </div>
                                </div>
                            )}

                            {artifact.conditionNotes && (
                                <div className="detail-section">
                                    <div className="detail-label">Condition Notes</div>
                                    <div className="detail-value">{artifact.conditionNotes}</div>
                                </div>
                            )}

                            {artifact.lastServiced && (
                                <div className="detail-section">
                                    <div className="detail-label">Last Serviced</div>
                                    <div className="detail-value">{artifact.lastServiced}</div>
                                </div>
                            )}

                            {artifact.servicingDetails && (
                                <div className="detail-section">
                                    <div className="detail-label">Servicing Details</div>
                                    <div className="detail-value">{artifact.servicingDetails}</div>
                                </div>
                            )}

                            <div className="controls" style={{ marginTop: '30px' }}>
                                <button className="btn" onClick={() => {
                                    setShowEditModal(artifact);
                                    onClose();
                                }}>
                                    Edit Artifact
                                </button>
                                <button className="btn btn-secondary" onClick={onClose}>
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const AddEditModal = ({ artifact, onClose }) => {
                const [formData, setFormData] = useState(artifact || {
                    itemNumber: '',
                    name: '',
                    location: '',
                    description: '',
                    donor: '',
                    condition: 'Good',
                    conditionNotes: '',
                    lastServiced: '',
                    servicingDetails: ''
                });

                const handleSubmit = async (e) => {
                    e.preventDefault();
                    try {
                        if (artifact) {
                            // Update existing
                            await db.collection('museum_artifacts').doc(artifact.id).update({
                                ...formData,
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        } else {
                            // Add new
                            await db.collection('museum_artifacts').add({
                                ...formData,
                                itemNumber: parseInt(formData.itemNumber) || null,
                                photos: [],
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                        onClose();
                    } catch (error) {
                        console.error('Error saving artifact:', error);
                        alert('Error saving artifact');
                    }
                };

                return (
                    <div className="modal" onClick={onClose}>
                        <div className="modal-content" onClick={e => e.stopPropagation()}>
                            <div className="modal-header">
                                <h2 className="modal-title">
                                    {artifact ? 'Edit Artifact' : 'Add New Artifact'}
                                </h2>
                                <button className="close-btn" onClick={onClose}>√ó</button>
                            </div>

                            <form onSubmit={handleSubmit}>
                                <div className="form-group">
                                    <label className="form-label">Item Number</label>
                                    <input 
                                        type="number" 
                                        className="form-input"
                                        value={formData.itemNumber}
                                        onChange={e => setFormData({...formData, itemNumber: e.target.value})}
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Artifact Name *</label>
                                    <input 
                                        type="text" 
                                        className="form-input" 
                                        required
                                        value={formData.name}
                                        onChange={e => setFormData({...formData, name: e.target.value})}
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Location *</label>
                                    <input 
                                        type="text" 
                                        className="form-input"
                                        required
                                        placeholder="e.g., Spitfire Hall"
                                        value={formData.location}
                                        onChange={e => setFormData({...formData, location: e.target.value})}
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Description</label>
                                    <textarea 
                                        className="form-textarea"
                                        value={formData.description}
                                        onChange={e => setFormData({...formData, description: e.target.value})}
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Donor / Source</label>
                                    <input 
                                        type="text" 
                                        className="form-input"
                                        value={formData.donor}
                                        onChange={e => setFormData({...formData, donor: e.target.value})}
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Condition</label>
                                    <select 
                                        className="form-select"
                                        value={formData.condition}
                                        onChange={e => setFormData({...formData, condition: e.target.value})}
                                    >
                                        <option value="Excellent">Excellent</option>
                                        <option value="Good">Good</option>
                                        <option value="Fair">Fair</option>
                                        <option value="Poor">Poor</option>
                                    </select>
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Condition Notes</label>
                                    <textarea 
                                        className="form-textarea"
                                        value={formData.conditionNotes}
                                        onChange={e => setFormData({...formData, conditionNotes: e.target.value})}
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Last Serviced</label>
                                    <input 
                                        type="date" 
                                        className="form-input"
                                        value={formData.lastServiced}
                                        onChange={e => setFormData({...formData, lastServiced: e.target.value})}
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Servicing Details</label>
                                    <textarea 
                                        className="form-textarea"
                                        value={formData.servicingDetails}
                                        onChange={e => setFormData({...formData, servicingDetails: e.target.value})}
                                    />
                                </div>

                                <div className="controls">
                                    <button type="submit" className="btn">
                                        {artifact ? 'Update' : 'Add'} Artifact
                                    </button>
                                    <button type="button" className="btn btn-secondary" onClick={onClose}>
                                        Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const FloorPlanModal = ({ onClose }) => {
                const [selectedRoom, setSelectedRoom] = useState(null);
                const [roomArtifacts, setRoomArtifacts] = useState([]);

                const roomZones = {
                    'Spitfire Hall': { x: 70, y: 15, width: 25, height: 20, color: '#e63946' },
                    'Strategy Room': { x: 35, y: 40, width: 20, height: 15, color: '#4361ee' },
                    'Strategy Room ': { x: 35, y: 40, width: 20, height: 15, color: '#4361ee' },
                    'Sapper Suite': { x: 20, y: 55, width: 18, height: 15, color: '#f72585' },
                    'Gunners Gallery': { x: 65, y: 50, width: 25, height: 15, color: '#4cc9f0' },
                    'Corridor': { x: 50, y: 30, width: 15, height: 40, color: '#7209b7' },
                    'Workshop': { x: 10, y: 20, width: 15, height: 20, color: '#f77f00' },
                    'Workshop ': { x: 10, y: 20, width: 15, height: 20, color: '#f77f00' },
                    'Office': { x: 80, y: 75, width: 15, height: 15, color: '#06d6a0' },
                    'Old store': { x: 5, y: 75, width: 12, height: 12, color: '#ffd60a' },
                    'Shop': { x: 85, y: 40, width: 10, height: 10, color: '#fb5607' },
                    'Shop (to move to sapper suite)': { x: 85, y: 40, width: 10, height: 10, color: '#fb5607' }
                };

                const handleRoomClick = (roomName) => {
                    setSelectedRoom(roomName);
                    const items = artifacts.filter(a => a.location?.trim() === roomName.trim());
                    setRoomArtifacts(items);
                };

                // Get unique room names from artifacts
                const uniqueRooms = [...new Set(artifacts.map(a => a.location).filter(Boolean))].sort();

                return (
                    <div className="modal" onClick={onClose}>
                        <div className="modal-content" onClick={e => e.stopPropagation()} style={{maxWidth: '1400px', maxHeight: '95vh'}}>
                            <div className="modal-header">
                                <h2 className="modal-title">Museum Floor Plan - Hay's Level</h2>
                                <button className="close-btn" onClick={onClose}>√ó</button>
                            </div>

                            <div style={{display: 'flex', gap: '20px', height: 'calc(95vh - 100px)'}}>
                                {/* Floor Plan Section */}
                                <div style={{flex: 2, overflow: 'auto'}}>
                                    <div style={{
                                        background: 'white', 
                                        borderRadius: '10px', 
                                        padding: '20px',
                                        position: 'relative',
                                        minHeight: '600px'
                                    }}>
                                        <h3 style={{color: '#333', marginBottom: '10px', textAlign: 'center'}}>
                                            Hay's Level Floor Plan
                                        </h3>
                                        <img 
                                            src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABtoAAATZCAIAAADVEVdyAAEAAElEQVR42uzde1xUdf7H8Q+COgyiXCYFhLyBZShYAlNqtpUi5SUv6WJrW3kJd7dVs93a32bruku727ZZul20wG5ukqaZYiJ4KW8FQglqmYA3UAYFZgSEUYH5/XFqlkXEgRmGgXk9H/5xPJw5c+Zz5nbe8+88HjcKAAAAAEAE/h9WPgXjfDE15QAAAABJRU5ErkJggg=="
                                            alt="Hay's Level Floor Plan"
                                            style={{
                                                width: '100%',
                                                height: 'auto',
                                                borderRadius: '10px',
                                                boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
                                            }}
                                        />
                                        <p style={{
                                            marginTop: '15px', 
                                            color: '#666', 
                                            textAlign: 'center',
                                            fontSize: '14px'
                                        }}>
                                            Click a room name on the right to see its artifacts ‚Üí
                                        </p>
                                    </div>
                                </div>

                                {/* Room List & Artifacts Section */}
                                <div style={{flex: 1, display: 'flex', flexDirection: 'column', gap: '15px', overflow: 'auto'}}>
                                    <div>
                                        <h3 style={{marginBottom: '15px', color: '#fff'}}>Locations ({uniqueRooms.length})</h3>
                                        <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                                            {uniqueRooms.map(room => {
                                                const count = artifacts.filter(a => a.location?.trim() === room.trim()).length;
                                                const zone = roomZones[room] || {};
                                                return (
                                                    <button
                                                        key={room}
                                                        onClick={() => handleRoomClick(room)}
                                                        style={{
                                                            background: selectedRoom === room ? zone.color || '#e63946' : 'rgba(255,255,255,0.1)',
                                                            border: 'none',
                                                            padding: '12px 15px',
                                                            borderRadius: '8px',
                                                            color: '#fff',
                                                            cursor: 'pointer',
                                                            textAlign: 'left',
                                                            transition: 'all 0.3s ease',
                                                            fontSize: '14px'
                                                        }}
                                                    >
                                                        <div style={{fontWeight: '600'}}>{room}</div>
                                                        <div style={{fontSize: '12px', opacity: 0.8, marginTop: '4px'}}>
                                                            {count} artifact{count !== 1 ? 's' : ''}
                                                        </div>
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    {selectedRoom && (
                                        <div style={{
                                            background: 'rgba(255,255,255,0.05)',
                                            borderRadius: '10px',
                                            padding: '15px',
                                            marginTop: '10px'
                                        }}>
                                            <h4 style={{marginBottom: '10px', color: '#fff'}}>
                                                {selectedRoom} ({roomArtifacts.length})
                                            </h4>
                                            <div style={{
                                                display: 'flex',
                                                flexDirection: 'column',
                                                gap: '8px',
                                                maxHeight: '300px',
                                                overflow: 'auto'
                                            }}>
                                                {roomArtifacts.map(artifact => (
                                                    <div
                                                        key={artifact.id}
                                                        onClick={() => {
                                                            setSelectedArtifact(artifact);
                                                            setShowFloorPlan(false);
                                                        }}
                                                        style={{
                                                            background: 'rgba(255,255,255,0.05)',
                                                            padding: '10px',
                                                            borderRadius: '6px',
                                                            cursor: 'pointer',
                                                            transition: 'all 0.2s ease'
                                                        }}
                                                    >
                                                        <div style={{fontSize: '13px', fontWeight: '600'}}>
                                                            #{artifact.itemNumber} {artifact.name}
                                                        </div>
                                                        {artifact.description && (
                                                            <div style={{
                                                                fontSize: '11px',
                                                                color: 'rgba(255,255,255,0.6)',
                                                                marginTop: '4px'
                                                            }}>
                                                                {artifact.description.substring(0, 50)}...
                                                            </div>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            if (loading) {
                return (
                    <div className="app-container">
                        <div className="empty-state">
                            <div className="empty-icon">‚è≥</div>
                            <h2>Loading artifacts...</h2>
                        </div>
                    </div>
                );
            }

            return (
                <div className="app-container">
                    <div className="header">
                        <div className="header-content">
                            <div className="logo-section">
                                <div className="logo">WT</div>
                                <div>
                                    <h1>WWII Tunnels Artifact Catalog</h1>
                                    <div className="subtitle">Museum Collection Management</div>
                                </div>
                            </div>
                            <div className="controls">
                                <button className="btn" onClick={() => setShowAddModal(true)}>
                                    + Add Artifact
                                </button>
                                {artifacts.length === 0 && (
                                    <button className="btn btn-success" onClick={importExcelData}>
                                        üì• Import {ARTIFACTS_DATA.length} Items
                                    </button>
                                )}
                                <button className="btn btn-secondary" onClick={() => setShowFloorPlan(true)}>
                                    üó∫Ô∏è Floor Plan
                                </button>
                            </div>
                        </div>
                    </div>

                    {importStatus && (
                        importStatus.success ? (
                            <div className="import-success">
                                <span>‚úì</span>
                                <span>Successfully imported {importStatus.count} artifacts!</span>
                            </div>
                        ) : (
                            <div className="import-error">
                                Error importing: {importStatus.message}
                            </div>
                        )
                    )}

                    <div className="stats-bar">
                        <div className="stat-item">
                            <div className="stat-label">Total Artifacts</div>
                            <div className="stat-value">{artifacts.length}</div>
                        </div>
                        <div className="stat-item">
                            <div className="stat-label">Locations</div>
                            <div className="stat-value">{locations.length - 1}</div>
                        </div>
                        <div className="stat-item">
                            <div className="stat-label">With Photos</div>
                            <div className="stat-value">
                                {artifacts.filter(a => a.photos?.length > 0).length}
                            </div>
                        </div>
                        <div className="stat-item">
                            <div className="stat-label">Showing</div>
                            <div className="stat-value">{filteredArtifacts.length}</div>
                        </div>
                    </div>

                    <div className="search-bar">
                        <input 
                            type="text" 
                            className="search-input" 
                            placeholder="Search by name, item #, location, description, or donor..."
                            value={searchTerm}
                            onChange={e => setSearchTerm(e.target.value)}
                        />
                        <div className="filters">
                            {locations.slice(0, 15).map(loc => (
                                <button 
                                    key={loc}
                                    className={`filter-btn ${selectedLocation === loc ? 'active' : ''}`}
                                    onClick={() => setSelectedLocation(loc)}
                                >
                                    {loc} {loc !== 'All' && `(${artifacts.filter(a => a.location === loc).length})`}
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="view-toggle">
                        <button 
                            className={`btn ${viewMode === 'gallery' ? '' : 'btn-secondary'}`}
                            onClick={() => setViewMode('gallery')}
                        >
                            üì∑ Gallery
                        </button>
                        <button 
                            className={`btn ${viewMode === 'list' ? '' : 'btn-secondary'}`}
                            onClick={() => setViewMode('list')}
                        >
                            üìã List
                        </button>
                    </div>

                    {filteredArtifacts.length === 0 ? (
                        <div className="empty-state">
                            <div className="empty-icon">üèõÔ∏è</div>
                            <h2>No artifacts found</h2>
                            <p>Try adjusting your search or filters</p>
                        </div>
                    ) : viewMode === 'gallery' ? (
                        <div className="gallery-grid">
                            {filteredArtifacts.map(artifact => (
                                <ArtifactCard key={artifact.id} artifact={artifact} />
                            ))}
                        </div>
                    ) : (
                        <ListView />
                    )}

                    {selectedArtifact && (
                        <DetailModal 
                            artifact={selectedArtifact} 
                            onClose={() => setSelectedArtifact(null)} 
                        />
                    )}

                    {showAddModal && (
                        <AddEditModal onClose={() => setShowAddModal(false)} />
                    )}

                    {showEditModal && (
                        <AddEditModal 
                            artifact={showEditModal}
                            onClose={() => setShowEditModal(false)} 
                        />
                    )}

                    {showFloorPlan && (
                        <FloorPlanModal onClose={() => setShowFloorPlan(false)} />
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
